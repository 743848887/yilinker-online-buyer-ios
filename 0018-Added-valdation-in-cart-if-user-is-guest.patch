From 5fc6d60de7a4e2c123dd5cb03170b97a0a16f9d0 Mon Sep 17 00:00:00 2001
From: jpChan15 <john.chan@easyshop.ph>
Date: Sat, 29 Aug 2015 18:22:55 +0800
Subject: [PATCH 18/27] Added valdation in cart if user is guest.

---
 .../resources/ViewController/CartViewController.swift      | 14 ++++++++------
 .../ViewController/HomeContainerViewController.swift       | 11 +++++++++--
 2 files changed, 17 insertions(+), 8 deletions(-)

diff --git a/YiLinkerOnlineBuyer/resources/ViewController/CartViewController.swift b/YiLinkerOnlineBuyer/resources/ViewController/CartViewController.swift
index 5a25c0e..bcf317f 100644
--- a/YiLinkerOnlineBuyer/resources/ViewController/CartViewController.swift
+++ b/YiLinkerOnlineBuyer/resources/ViewController/CartViewController.swift
@@ -56,8 +56,8 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
             emptyView?.hidden = true
         }
         NSNotificationCenter.defaultCenter().postNotificationName("SwipeForOptionsCellEnclosingTableViewDidBeginScrollingNotification", object: self)
-        
         getCartData()
+        
     }
     
     @IBAction func buttonClicked(sender: AnyObject) {
@@ -90,7 +90,7 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
             
             }, failure: {
                 (task: NSURLSessionDataTask!, error: NSError!) in
-                self.showAlert("Error", message: "Something went wrong. . .")
+                UIAlertController.displayErrorMessageWithTarget(self, errorMessage: "Something went wrong. . .", title: "Error")
                 self.dismissLoader()
         })
     }
@@ -105,7 +105,7 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
             self.dismissLoader()
             }, failure: {
                 (task: NSURLSessionDataTask!, error: NSError!) in
-                self.showAlert("Error", message: "Something went wrong. . .")
+                UIAlertController.displayErrorMessageWithTarget(self, errorMessage: "Something went wrong. . .", title: "Error")
                 self.dismissLoader()
         })
     }
@@ -122,7 +122,7 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
             }
             }, failure: {
                 (task: NSURLSessionDataTask!, error: NSError!) in
-                self.showAlert("Error", message: "Something went wrong. . .")
+                UIAlertController.displayErrorMessageWithTarget(self, errorMessage: "Something went wrong. . .", title: "Error")
                 self.updateCounterLabel()
                 self.dismissLoader()
         })
@@ -146,6 +146,8 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
         if tableData.count != 0 {
             let badgeValue = (self.tabBarController!.tabBar.items![4] as! UITabBarItem).badgeValue?.toInt()
             (self.tabBarController!.tabBar.items![4] as! UITabBarItem).badgeValue = String(tableData.count)
+        } else {
+            (self.tabBarController!.tabBar.items![4] as! UITabBarItem).badgeValue = nil
         }
     }
     
@@ -256,7 +258,7 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
             ]
             fireDeleteCartItem(APIAtlas.updateCartUrl, params: params)
         } else {
-            showAlert("Connection Unreachable", message: "Cannot retrieve data. Please check your internet connection.")
+            UIAlertController.displayErrorMessageWithTarget(self, errorMessage: "Cannot retrieve data. Please check your internet connection.", title: "Connection Unreachable")
         }
     }
     
@@ -413,7 +415,7 @@ class CartViewController: UIViewController, UITableViewDelegate, UITableViewData
                 SVProgressHUD.dismiss()
                 let task: NSHTTPURLResponse = task.response as! NSHTTPURLResponse
                 
-                self.showAlert("Something went wrong", message: "")
+               "Cannot retrieve data. Please check your internet connection."
                 
         })
     }
diff --git a/YiLinkerOnlineBuyer/resources/ViewController/HomeContainerViewController.swift b/YiLinkerOnlineBuyer/resources/ViewController/HomeContainerViewController.swift
index 8dc29c4..606c2a3 100644
--- a/YiLinkerOnlineBuyer/resources/ViewController/HomeContainerViewController.swift
+++ b/YiLinkerOnlineBuyer/resources/ViewController/HomeContainerViewController.swift
@@ -77,7 +77,14 @@ class HomeContainerViewController: UIViewController, UITabBarControllerDelegate,
     }
     
     func tabBarController(tabBarController: UITabBarController, shouldSelectViewController viewController: UIViewController) -> Bool {
-        if self != viewController && viewController != tabBarController.viewControllers![2] as! UIViewController {
+        if viewController == tabBarController.viewControllers![4] as! UIViewController {
+            if SessionManager.isLoggedIn() {
+                return true
+            } else {
+                UIAlertController.displayErrorMessageWithTarget(self, errorMessage: "Please log in to view your cart", title: "Error")
+                return false
+            }
+        } else if self != viewController && viewController != tabBarController.viewControllers![2] as! UIViewController {
             return true
         } else if self.customTabBarController?.isValidToSwitchToMenuTabBarItems != true {
             let storyBoard: UIStoryboard = UIStoryboard(name: "HomeStoryBoard", bundle: nil)
@@ -109,10 +116,10 @@ class HomeContainerViewController: UIViewController, UITabBarControllerDelegate,
             self.tabBarController?.presentViewController(animatedViewController!, animated: false, completion: nil)
             return false
         } else {
-            
             return true
         }
         
+        
     }
     
     // This function is for executing child view logic code
-- 
2.3.2 (Apple Git-55)

