From 162402bbb7c11849ec00d920f86e695c72a5d480 Mon Sep 17 00:00:00 2001
From: Rj <rj.constantino@easyshop.ph>
Date: Fri, 28 Aug 2015 05:20:55 +0800
Subject: [PATCH 02/27] Added model for get address.

---
 YiLinkerOnlineBuyer.xcodeproj/project.pbxproj      |   8 +
 .../resources/Model/AddressModelV2.swift           | 181 +++++++++++++++++++++
 .../resources/Model/GetAddressesModel.swift        |  48 ++++++
 .../resources/StoryBoard/HomeStoryBoard.storyboard |   2 +-
 .../ChangeAddressViewController.swift              |  71 +++++++-
 5 files changed, 308 insertions(+), 2 deletions(-)
 create mode 100644 YiLinkerOnlineBuyer/resources/Model/AddressModelV2.swift
 create mode 100644 YiLinkerOnlineBuyer/resources/Model/GetAddressesModel.swift

diff --git a/YiLinkerOnlineBuyer.xcodeproj/project.pbxproj b/YiLinkerOnlineBuyer.xcodeproj/project.pbxproj
index d9894c6..50f1656 100644
--- a/YiLinkerOnlineBuyer.xcodeproj/project.pbxproj
+++ b/YiLinkerOnlineBuyer.xcodeproj/project.pbxproj
@@ -225,6 +225,8 @@
 		26AFB3CA1B79DE5C00E50926 /* ProductAttributeCollectionViewCell.xib in Resources */ = {isa = PBXBuildFile; fileRef = 26AFB3C61B79DE5C00E50926 /* ProductAttributeCollectionViewCell.xib */; };
 		26AFB3CB1B79DE5C00E50926 /* ProductSellerViewCollectionViewCell.xib in Resources */ = {isa = PBXBuildFile; fileRef = 26AFB3C71B79DE5C00E50926 /* ProductSellerViewCollectionViewCell.xib */; };
 		26B1B8A01B86D4BD006405CE /* TransactionDetailsView.swift in Sources */ = {isa = PBXBuildFile; fileRef = 26B1B89F1B86D4BD006405CE /* TransactionDetailsView.swift */; };
+		26C285421B8FAA48005EBD3A /* GetAddressesModel.swift in Sources */ = {isa = PBXBuildFile; fileRef = 26C285411B8FAA48005EBD3A /* GetAddressesModel.swift */; };
+		26C285441B8FADE3005EBD3A /* AddressModelV2.swift in Sources */ = {isa = PBXBuildFile; fileRef = 26C285431B8FADE3005EBD3A /* AddressModelV2.swift */; };
 		26D54FDF1B860CF400522398 /* TransactionViewController.swift in Sources */ = {isa = PBXBuildFile; fileRef = 26D54FDD1B860CF400522398 /* TransactionViewController.swift */; };
 		26D54FE01B860CF400522398 /* TransactionViewController.xib in Resources */ = {isa = PBXBuildFile; fileRef = 26D54FDE1B860CF400522398 /* TransactionViewController.xib */; };
 		26D54FE71B86136300522398 /* TransactionTableViewCell.swift in Sources */ = {isa = PBXBuildFile; fileRef = 26D54FE51B86136300522398 /* TransactionTableViewCell.swift */; };
@@ -525,6 +527,8 @@
 		26AFB3C61B79DE5C00E50926 /* ProductAttributeCollectionViewCell.xib */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = file.xib; path = ProductAttributeCollectionViewCell.xib; sourceTree = "<group>"; };
 		26AFB3C71B79DE5C00E50926 /* ProductSellerViewCollectionViewCell.xib */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = file.xib; path = ProductSellerViewCollectionViewCell.xib; sourceTree = "<group>"; };
 		26B1B89F1B86D4BD006405CE /* TransactionDetailsView.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; name = TransactionDetailsView.swift; path = YiLinkerOnlineBuyer/resources/View/TransactionDetailsView.swift; sourceTree = SOURCE_ROOT; };
+		26C285411B8FAA48005EBD3A /* GetAddressesModel.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; name = GetAddressesModel.swift; path = YiLinkerOnlineBuyer/resources/Model/GetAddressesModel.swift; sourceTree = SOURCE_ROOT; };
+		26C285431B8FADE3005EBD3A /* AddressModelV2.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; name = AddressModelV2.swift; path = YiLinkerOnlineBuyer/resources/Model/AddressModelV2.swift; sourceTree = SOURCE_ROOT; };
 		26D54FDD1B860CF400522398 /* TransactionViewController.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; name = TransactionViewController.swift; path = YiLinkerOnlineBuyer/resources/ViewController/TransactionViewController.swift; sourceTree = SOURCE_ROOT; };
 		26D54FDE1B860CF400522398 /* TransactionViewController.xib */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = file.xib; name = TransactionViewController.xib; path = YiLinkerOnlineBuyer/resources/ViewController/TransactionViewController.xib; sourceTree = SOURCE_ROOT; };
 		26D54FE51B86136300522398 /* TransactionTableViewCell.swift */ = {isa = PBXFileReference; fileEncoding = 4; lastKnownFileType = sourcecode.swift; name = TransactionTableViewCell.swift; path = YiLinkerOnlineBuyer/resources/ViewController/TransactionTableViewCell.swift; sourceTree = SOURCE_ROOT; };
@@ -767,6 +771,8 @@
 				79E85FCD1B8A1F5800428AA1 /* ActivityLogModel.swift */,
 				79E85FCF1B8A1FBD00428AA1 /* ActivityModel.swift */,
 				79E68B901B8B0AE9008626E4 /* PointModel.swift */,
+				26C285411B8FAA48005EBD3A /* GetAddressesModel.swift */,
+				26C285431B8FADE3005EBD3A /* AddressModelV2.swift */,
 			);
 			path = Model;
 			sourceTree = "<group>";
@@ -1394,6 +1400,7 @@
 				0C374F001B889D9A0050AE1D /* PlainTableViewCell.swift in Sources */,
 				26AFB3A91B79DE2900E50926 /* ProductDescriptionView.swift in Sources */,
 				0C99373E1B750583000D6074 /* ParseLocalJSON.swift in Sources */,
+				26C285441B8FADE3005EBD3A /* AddressModelV2.swift in Sources */,
 				26DFF6371B87B0AA005D8EDE /* TransactionProductImagesView.swift in Sources */,
 				0C99374D1B750583000D6074 /* NewSellerCollectionViewCell.swift in Sources */,
 				26AFB39B1B79DDEA00E50926 /* ProductAttributeModel.swift in Sources */,
@@ -1436,6 +1443,7 @@
 				79E68B851B8AF4D0008626E4 /* PointsEarnedTableViewCell.swift in Sources */,
 				0C99375D1B750583000D6074 /* HomeContainerViewController.swift in Sources */,
 				79E85FCE1B8A1F5800428AA1 /* ActivityLogModel.swift in Sources */,
+				26C285421B8FAA48005EBD3A /* GetAddressesModel.swift in Sources */,
 				0C2F45291B85E95D00021F45 /* ChangeAddressCollectionViewCell.swift in Sources */,
 				79E68B931B8B0B8D008626E4 /* PointsTableViewCell.swift in Sources */,
 				79E68B8D1B8B0431008626E4 /* PointsBreakdownTableViewCell.swift in Sources */,
diff --git a/YiLinkerOnlineBuyer/resources/Model/AddressModelV2.swift b/YiLinkerOnlineBuyer/resources/Model/AddressModelV2.swift
new file mode 100644
index 0000000..eb2e209
--- /dev/null
+++ b/YiLinkerOnlineBuyer/resources/Model/AddressModelV2.swift
@@ -0,0 +1,181 @@
+//
+//  AddressModelV2.swift
+//  YiLinkerOnlineBuyer
+//
+//  Created by Rj Constantino on 8/28/15.
+//  Copyright (c) 2015 yiLinker-online-buyer. All rights reserved.
+//
+
+import Foundation
+
+class AddressModelV2 {
+    
+    var userAddressId: Int = 0
+    var locationId: Int = 0
+    var title: String = ""
+    var unitNumber: String = ""
+    var buildingName: String = ""
+    var streetNumber: Int = 0
+    var streetName: String = ""
+    var subdivision: String = ""
+    var zipCode: String = ""
+    var streetAddress: String = ""
+    var country: String = ""
+    var island: String = ""
+    var region: String = ""
+    var province: String = ""
+    var city: String = ""
+    var municipality: String = ""
+    var barangay: String = ""
+    var longitude: String = ""
+    var landline: String = ""
+    var latitude: String = ""
+    var isDefault: Bool = false
+    
+    class func parseAddressFromDictionary(reviews: NSDictionary) -> AddressModelV2 {
+        
+        var model = AddressModelV2()
+        
+        if reviews.isKindOfClass(NSDictionary) {
+            
+            if let value: AnyObject = reviews["userAddressId"] {
+                if value as! NSObject != NSNull() {
+                    model.userAddressId = value as! Int
+                }
+            }
+            
+            if let value: AnyObject = reviews["locationId"] {
+                if value as! NSObject != NSNull() {
+                    model.locationId = value as! Int
+                }
+            }
+            
+            if let value: AnyObject = reviews["title"] {
+                if value as! NSObject != NSNull() {
+                    model.title = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["unitNumber"] {
+                if value as! NSObject != NSNull() {
+                    model.unitNumber = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["buildingName"] {
+                if value as! NSObject != NSNull() {
+                    model.buildingName = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["streetNumber"] {
+                if value as! NSObject != NSNull() {
+                    model.streetNumber = value as! Int
+                }
+            }
+            
+            if let value: AnyObject = reviews["streetName"] {
+                if value as! NSObject != NSNull() {
+                    model.streetName = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["subdivision"] {
+                if value as! NSObject != NSNull() {
+                    model.subdivision = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["zipCode"] {
+                if value as! NSObject != NSNull() {
+                    model.zipCode = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["streetAddress"] {
+                if value as! NSObject != NSNull() {
+                    model.streetAddress = value as! String
+                }
+            }
+            
+            if let value: AnyObject = reviews["country"] {
+                if value as! NSObject != NSNull() {
+                    model.country = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["island"] {
+                if value as! NSObject != NSNull() {
+                    model.island = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["region"] {
+                if value as! NSObject != NSNull() {
+                    model.region = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["province"] {
+                if value as! NSObject != NSNull() {
+                    model.province = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["city"] {
+                if value as! NSObject != NSNull() {
+                    model.city = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["municipality"] {
+                if value as! NSObject != NSNull() {
+                    model.municipality = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["barangay"] {
+                if value as! NSObject != NSNull() {
+                    model.barangay = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["longitude"] {
+                if value as! NSObject != NSNull() {
+                    model.longitude = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["latitude"] {
+                if value as! NSObject != NSNull() {
+                    model.latitude = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["landline"] {
+                if value as! NSObject != NSNull() {
+                    model.landline = value as! String
+                }
+                
+            }
+            
+            if let value: AnyObject = reviews["isDefault"] {
+                if value as! NSObject != NSNull() {
+                    model.isDefault = value as! Bool
+                }
+            }
+        }
+        
+        return model
+    }
+    
+}
\ No newline at end of file
diff --git a/YiLinkerOnlineBuyer/resources/Model/GetAddressesModel.swift b/YiLinkerOnlineBuyer/resources/Model/GetAddressesModel.swift
new file mode 100644
index 0000000..d0ada2b
--- /dev/null
+++ b/YiLinkerOnlineBuyer/resources/Model/GetAddressesModel.swift
@@ -0,0 +1,48 @@
+//
+//  GetAddressesModel.swift
+//  YiLinkerOnlineBuyer
+//
+//  Created by Rj Constantino on 8/28/15.
+//  Copyright (c) 2015 yiLinker-online-buyer. All rights reserved.
+//
+
+import Foundation
+
+class GetAddressesModel: NSObject {
+    
+    var message: String = ""
+    var isSuccessful: Bool = false
+    var listOfAddress: [AddressModelV2] = []
+    
+    init(message: String, isSuccessful: Bool, listOfAddress: [AddressModelV2]) {
+        self.message = message
+        self.isSuccessful = isSuccessful
+        self.listOfAddress = listOfAddress
+    }
+    
+    class func parseDataWithDictionary(dictionary: AnyObject) -> GetAddressesModel {
+        var message: String = ""
+        var isSuccessful: Bool = false
+        var listOfAddress: [AddressModelV2] = []
+        
+        if dictionary.isKindOfClass(NSDictionary) {
+            if let tempVar = dictionary["message"] as? String {
+                message = tempVar
+            }
+            
+            if let tempVar = dictionary["isSuccessful"] as? Bool {
+                isSuccessful = tempVar
+            }
+            
+            if let value: AnyObject = dictionary["data"] {
+                
+                for subValue in value as! NSArray {
+                    let model: AddressModelV2 = AddressModelV2.parseAddressFromDictionary(subValue as! NSDictionary)
+                    listOfAddress.append(model)
+                }
+            }
+        }
+        
+        return GetAddressesModel(message: message, isSuccessful: isSuccessful, listOfAddress: listOfAddress)
+    }
+}
\ No newline at end of file
diff --git a/YiLinkerOnlineBuyer/resources/StoryBoard/HomeStoryBoard.storyboard b/YiLinkerOnlineBuyer/resources/StoryBoard/HomeStoryBoard.storyboard
index 952e44a..954d6d1 100644
--- a/YiLinkerOnlineBuyer/resources/StoryBoard/HomeStoryBoard.storyboard
+++ b/YiLinkerOnlineBuyer/resources/StoryBoard/HomeStoryBoard.storyboard
@@ -282,7 +282,7 @@
                             <view contentMode="scaleToFill" translatesAutoresizingMaskIntoConstraints="NO" id="DP3-44-XbQ" userLabel="Counter View">
                                 <rect key="frame" x="0.0" y="64" width="375" height="35"/>
                                 <subviews>
-                                    <label opaque="NO" userInteractionEnabled="NO" contentMode="left" horizontalHuggingPriority="251" verticalHuggingPriority="251" fixedFrame="YES" text=" " lineBreakMode="tailTruncation" baselineAdjustment="alignBaselines" adjustsFontSizeToFit="NO" translatesAutoresizingMaskIntoConstraints="NO" id="PGR-Y7-dO2">
+                                    <label opaque="NO" userInteractionEnabled="NO" contentMode="left" horizontalHuggingPriority="251" verticalHuggingPriority="251" text=" " lineBreakMode="tailTruncation" baselineAdjustment="alignBaselines" adjustsFontSizeToFit="NO" translatesAutoresizingMaskIntoConstraints="NO" id="PGR-Y7-dO2">
                                         <rect key="frame" x="8" y="7" width="359" height="21"/>
                                         <fontDescription key="fontDescription" type="system" pointSize="14"/>
                                         <color key="textColor" white="0.33333333333333331" alpha="1" colorSpace="calibratedWhite"/>
diff --git a/YiLinkerOnlineBuyer/resources/ViewController/ChangeAddressViewController.swift b/YiLinkerOnlineBuyer/resources/ViewController/ChangeAddressViewController.swift
index b209de9..f1c8dcc 100644
--- a/YiLinkerOnlineBuyer/resources/ViewController/ChangeAddressViewController.swift
+++ b/YiLinkerOnlineBuyer/resources/ViewController/ChangeAddressViewController.swift
@@ -8,15 +8,19 @@
 
 import UIKit
 
-class ChangeAddressViewController: UIViewController, UICollectionViewDelegateFlowLayout, UICollectionViewDataSource, UICollectionViewDelegate, ChangeAddressCollectionViewCellDelegate, ChangeAddressFooterCollectionViewCellDelegate, AddAddressTableViewControllerDelegate {
+class ChangeAddressViewController: UIViewController, UICollectionViewDelegateFlowLayout, UICollectionViewDataSource, UICollectionViewDelegate, ChangeAddressCollectionViewCellDelegate, ChangeAddressFooterCollectionViewCellDelegate, AddAddressTableViewControllerDelegate, EmptyViewDelegate {
 
     @IBOutlet weak var collectionView: UICollectionView!
    
     var cellCount: Int = 3
     var selectedIndex: Int = 0
     
+    
+    var emptyView: EmptyView?
+    
     override func viewDidLoad() {
         super.viewDidLoad()
+        requestGetAddressess()
         
         self.titleView()
         self.backButton()
@@ -156,4 +160,69 @@ class ChangeAddressViewController: UIViewController, UICollectionViewDelegateFlo
         let indexPath: NSIndexPath = NSIndexPath(forItem: self.cellCount, inSection: 0)
         self.addCellInIndexPath(indexPath)
     }
+    
+    // MARK: - Empty View
+    
+    func addEmptyView() {
+        self.emptyView = UIView.loadFromNibNamed("EmptyView", bundle: nil) as? EmptyView
+        self.emptyView?.frame = self.view.frame
+        self.emptyView!.delegate = self
+        self.view.addSubview(self.emptyView!)
+    }
+    
+    func didTapReload() {
+        requestGetAddressess()
+        self.emptyView?.removeFromSuperview()
+    }
+    
+    // MARK: - Requests
+    
+    func requestGetAddressess() {
+        SVProgressHUD.show()
+        
+        let manager = APIManager.sharedInstance
+        let url = "http://online.api.easydeal.ph/api/v1/auth/address/getUserAddresses"
+        let params = ["access_token": "ZGJiNjU5ZGQ0ZjVlOTFkYjRhMGJiYTExZjYxMDY1Mjg3YTFkNjllZDdmYjY2OWQwODNlYTI5MjhiYjE0YmViOA"]
+        
+        manager.POST(url, parameters: params, success: {
+            (task: NSURLSessionDataTask!, responseObject: AnyObject!) in
+            
+            GetAddressesModel.parseDataWithDictionary(responseObject)
+
+            SVProgressHUD.dismiss()
+            
+            }, failure: {
+                (task: NSURLSessionDataTask!, error: NSError!) in
+                let task: NSHTTPURLResponse = task.response as! NSHTTPURLResponse
+                if task.statusCode == 401 {
+                    self.requestRefreshToken()
+                } else {
+                    self.addEmptyView()
+                    SVProgressHUD.dismiss()
+                }
+        })
+    }
+    
+    func requestRefreshToken() {
+        let url: String = "http://online.api.easydeal.ph/api/v1/login"
+        let params: NSDictionary = ["client_id": Constants.Credentials.clientID,
+            "client_secret": Constants.Credentials.clientSecret,
+            "grant_type": Constants.Credentials.grantRefreshToken,
+            "refresh_token": SessionManager.refreshToken()]
+        
+        let manager = APIManager.sharedInstance
+        manager.POST(url, parameters: params, success: {
+            (task: NSURLSessionDataTask!, responseObject: AnyObject!) in
+            
+            self.requestGetAddressess()
+            
+            }, failure: {
+                (task: NSURLSessionDataTask!, error: NSError!) in
+                SVProgressHUD.dismiss()
+                let alertController = UIAlertController(title: "Something went wrong", message: "", preferredStyle: .Alert)
+                let defaultAction = UIAlertAction(title: "OK", style: .Default, handler: nil)
+                alertController.addAction(defaultAction)
+                self.presentViewController(alertController, animated: true, completion: nil)
+        })
+    }
 }
-- 
2.3.2 (Apple Git-55)

